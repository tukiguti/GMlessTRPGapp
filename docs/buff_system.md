# GMレスLoL風TRPG - バフシステム

## 目次
1. [バフシステム概要](#バフシステム概要)
2. [ジャングルバフ](#ジャングルバフ)
3. [オブジェクトバフ](#オブジェクトバフ)
4. [バフの管理](#バフの管理)
5. [バフの戦略的使用](#バフの戦略的使用)
6. [バフ/デバフの技術的管理](#バフデバフの技術的管理)
7. [スキルクールダウン管理](#スキルクールダウン管理)
8. [ステータス計算システム](#ステータス計算システム)

---

## バフシステム概要

バフは一時的または永続的にキャラクターを強化する効果です。
このゲームには以下の2種類のバフがあります：

### 1. ジャングルバフ
- **赤バフ（Red Buff）**: 攻撃力上昇＋スロー効果
- **青バフ（Blue Buff）**: クールダウン短縮＋ユーティリティ上昇

### 2. オブジェクトバフ
- **ドラゴンバフ**: 4種類のエレメンタルドラゴン、永続効果
- **バロンバフ**: チーム全体の強力な一時強化
- **ヘラルド**: タワー攻撃支援（召喚型）

---

## ジャングルバフ

ジャングルバフはJGがバフファームで獲得できます。
他のプレイヤーも敵陣ジャングルに侵入してバフを奪うことができます。

### 赤バフ（Red Buff / Crest of Cinders）

#### 獲得方法
- ジャングルエリア（TOP-MIDまたはMID-BOT）でバフファームを選択
- 赤バフモンスターを倒す（1ターンで完了）
- ゴールド: 80G

#### 効果
- **攻撃力**: +2.0
- **スロー効果**: マッチアップ判定で勝利した場合、相手の次のターンの移動力-2
- **持続時間**: 9ターン（90秒）

#### 詳細
**攻撃力上昇**:
- マッチアップ判定に+2.0の補正
- ダメージ計算にも影響

**スロー効果**:
- マッチアップ判定で勝利した相手に付与
- 相手の次のターンのみ移動力-2
- ローム・ガンクの妨害に有効
- CC回避判定にも影響（移動力が下がるため回避しにくくなる）

#### 適正プレイヤー
- **JG**: ガンク時の攻撃力上昇とスロー効果
- **ADファイター**: 継続戦闘での攻撃力上昇
- **ADアサシン**: ガンク時の火力強化

#### 例
**状況**: JGが赤バフを獲得してガンク

**ターン5**:
1. JGが赤バフファーム成功
2. 赤バフ獲得: 攻撃力+2.0、スロー効果付与、持続9ターン

**ターン7**:
1. JGがMIDレーンにガンク
2. マッチアップ判定: 1d20 + 5.0（基礎攻撃力） + 2.0（赤バフ） + 3（視界なし） = 1d20 + 10.0
3. 勝利した場合、敵MIDの次のターン（ターン8）の移動力-2

---

### 青バフ（Blue Buff / Crest of Insight）

#### 獲得方法
- ジャングルエリア（TOP-MIDまたはMID-BOT）でバフファームを選択
- 青バフモンスターを倒す（1ターンで完了）
- ゴールド: 80G

#### 効果
- **ユーティリティ**: +2.0
- **クールダウン短縮**: スキル・アイテムのクールダウン-1ターン（最低1ターン）
- **持続時間**: 9ターン（90秒）

#### 詳細
**ユーティリティ上昇**:
- CC判定の成功率向上（1d20 + ユーティリティ）
- ワード配置・破壊の判定に有利

**クールダウン短縮（CDR）**:
- 通常スキル: 2ターン → 1ターン
- ULT: 5ターン → 4ターン
- アクティブアイテム（ゾーニャ）: 5ターン → 4ターン

**重要**: クールダウンは最低1ターン（0ターンにはならない）

#### 適正プレイヤー
- **APメイジ**: スキル回転率の向上
- **APアサシン**: スキル回転率の向上
- **サポート**: CC判定の成功率向上、ユーティリティ強化

#### 例
**状況**: APメイジが青バフを獲得

**ターン10**:
1. APメイジが青バフ獲得（敵陣ジャングルで奪取）
2. 青バフ効果: ユーティリティ+2.0、CDR、持続9ターン

**ターン12**:
1. APメイジが通常スキル（ダメージ+3）を使用
2. 通常はクールダウン2ターン → 青バフ効果で1ターンに短縮
3. ターン13で再使用可能

---

### ジャングルバフの管理

#### バフの奪取（カウンタージャングル）
- 敵陣ジャングルに侵入して敵のバフを奪う戦術
- リスク: 敵に発見されると不利な戦闘になる
- リワード: 自分がバフを得て、敵がバフを失う（2倍のアドバンテージ）

#### バフの譲渡
- JGが味方にバフを譲ることも戦略的に有効
- 例: 青バフをAPメイジに譲る（スキル回転率向上）

#### バフのリスポーン
- バフモンスターは倒されてから**30ターン（5分）**後にリスポーン
- 戦略的なタイミングでファームすることが重要

---

## オブジェクトバフ

オブジェクトバフはチーム全体に影響する強力な効果です。

### ドラゴンバフ

ドラゴンは4種類のエレメンタルドラゴンがあり、それぞれ異なる永続バフを提供します。

#### ドラゴン撃破の基本
- **必要ターン数**: 2ターン（20秒）
- **推奨人数**: 1-2人
- **ゴールド**: 300G（チーム全員に分配）
- **経験値**: 50XP（参加者のみ）
- **バフ**: 永続（死亡しても消えない）

#### 1. インフェルナルドラゴン（炎竜）

**効果**: チーム全員の攻撃力+1.5

**適正チーム**:
- AD/AP火力が多いチーム
- バースト型チーム

**スタック**:
- 2体目撃破: 攻撃力+3.0（累積）
- 3体目撃破: 攻撃力+4.5（累積）
- 4体目撃破: **ドラゴンソウル**獲得（後述）

#### 2. マウンテンドラゴン（岩竜）

**効果**: チーム全員の防御力+1.5

**適正チーム**:
- タンクが多いチーム
- 防御重視のチーム

**スタック**:
- 2体目撃破: 防御力+3.0（累積）
- 3体目撃破: 防御力+4.5（累積）
- 4体目撃破: **ドラゴンソウル**獲得

#### 3. オーシャンドラゴン（水竜）

**効果**: 戦闘していないターンにHP +50回復

**適正チーム**:
- 継続戦闘が得意なチーム
- サステイン（持久力）重視

**スタック**:
- 2体目撃破: HP +100回復/ターン（累積）
- 3体目撃破: HP +150回復/ターン（累積）
- 4体目撃破: **ドラゴンソウル**獲得

#### 4. クラウドドラゴン（風竜）

**効果**: チーム全員の移動力+1.0

**適正チーム**:
- ローム・ガンクが多いチーム
- 機動力重視

**スタック**:
- 2体目撃破: 移動力+2.0（累積）
- 3体目撃破: 移動力+3.0（累積）
- 4体目撃破: **ドラゴンソウル**獲得

#### ドラゴンソウル

同じ種類のドラゴンを4体撃破すると、**ドラゴンソウル**を獲得します。

| ソウル種類 | 追加効果 |
|---------|---------|
| **インフェルナルソウル** | マッチアップ判定で勝利時、追加で20ダメージ（防御力無視） |
| **マウンテンソウル** | HP が50%以下の時、防御力+5追加 |
| **オーシャンソウル** | 戦闘していないターンのHP回復量が2倍 |
| **クラウドソウル** | ローム・ガンク時、移動力ボーナスが2倍 |

#### エルダードラゴン

4体目のドラゴン撃破後、**エルダードラゴン**が出現します。

**効果**: チーム全員に以下の効果（永続）
- 攻撃力+3.0
- 防御力+2.0
- マッチアップ判定で勝利時、追加で30ダメージ（防御力無視）

**重要**: エルダードラゴンはゲーム終盤の最重要オブジェクト

---

### バロンバフ（Baron Nashor）

#### バロン撃破の基本
- **必要ターン数**: 3ターン（30秒）
- **推奨人数**: 2-3人
- **ゴールド**: 500G（チーム全員に分配）
- **経験値**: 100XP（参加者のみ）
- **出現時間**: 71ターン（12分）以降
- **バフ持続時間**: 18ターン（180秒 / 3分）

#### バロンバフ効果

**チーム全員に付与**:
- **攻撃力**: +3.0
- **防御力**: +2.0
- **移動力**: +1.0
- **タワーダメージ増加**: タワーへのダメージ+50%
- **ミニオン強化**: 味方ミニオンのHP・攻撃力が2倍（簡易ルールでは省略可能）

#### バロンバフの戦略的価値

**プッシュ力の大幅向上**:
- タワーダメージ+50%により、短時間で複数タワーを破壊可能
- ミニオン強化により、レーンプッシュが加速

**チーム戦の優位性**:
- 攻撃力+3.0、防御力+2.0により、チーム戦で有利
- 移動力+1.0により、ローム・ガンクも強化

**タイミング**:
- 中盤～終盤の重要なターニングポイント
- バロン撃破後、18ターン以内にタワー破壊・ネクサスプッシュを狙う

#### 例

**状況**: レベル14のチームがバロンに挑戦

**ターン75**:
1. 味方3人（JG、TOP、MID）がバロン挑戦開始
2. 3ターン必要

**ターン76**:
1. バロン挑戦2ターン目
2. 敵チームが接近（ワードで発見）

**ターン77**:
1. バロン挑戦3ターン目
2. バロン撃破成功
3. チーム全員にバロンバフ付与（18ターン持続）
4. ゴールド500G獲得（チーム全員）

**ターン78-95**:
1. バロンバフを活用してMIDレーンをプッシュ
2. タワーダメージ+50%により、インナータワー・ネクサスタワーを破壊
3. ネクサスを破壊して勝利

---

### ヘラルド（Rift Herald）

#### ヘラルド撃破の基本
- **必要ターン数**: 2ターン（20秒）
- **推奨人数**: 1-2人
- **ゴールド**: 200G（チーム全員に分配）
- **経験値**: 50XP（参加者のみ）
- **出現時間**: 1-70ターン（0-12分）
- **効果**: ヘラルドの目（召喚アイテム）を獲得

#### ヘラルドの目（Eye of the Herald）

**効果**: 任意のレーンに召喚可能（1回のみ）

**召喚後の行動**:
1. ヘラルドがそのレーンのタワーに突撃
2. タワーに**1500ダメージ**（固定、防御力無視）
3. ダメージを与えた後、ヘラルドは消滅

**使用タイミング**:
- ターン開始時に使用宣言
- 使用したターンに効果発動

**戦略的価値**:
- 序盤～中盤のタワー破壊を加速
- 固定1500ダメージにより、アウタータワー（3000HP）を半分削る
- プレートゴールド（タワーのHP削り報酬）を獲得

#### 例

**状況**: レベル8のJGとTOPがヘラルドに挑戦

**ターン35**:
1. JGとTOPがヘラルド挑戦開始

**ターン36**:
1. ヘラルド挑戦2ターン目
2. ヘラルド撃破成功
3. JGがヘラルドの目を獲得

**ターン40**:
1. JGがTOPレーンでヘラルドの目を使用
2. ヘラルド召喚
3. TOPレーンのアウタータワーに1500ダメージ
4. タワーHP: 3000 → 1500

**ターン41**:
1. JGとTOPが協力してタワーを攻撃
2. タワー破壊成功

---

## バフの管理

### バフの重複

#### 同種バフの重複
- **ジャングルバフ**: 赤バフと青バフは同時に所持可能
- **ドラゴンバフ**: 複数種類のドラゴンバフは累積（最大4種類）
- **バロンバフ**: ドラゴンバフと同時に所持可能

#### バフの上書き
- **赤バフ/青バフ**: 新しいバフを獲得すると、持続時間がリセット
- **ドラゴンバフ**: 永続のためリセットなし
- **バロンバフ**: 複数回撃破すると持続時間がリセット

### バフの表示

各プレイヤーのステータスシートに以下を記載：
- 所持しているバフの種類
- バフの残りターン数
- バフによるステータス補正値

---

## バフの戦略的使用

### 序盤（1-30ターン）

**重点**: ジャングルバフの獲得
- JGが赤バフ/青バフをファーム
- レーナーは序盤はバフ不要

**ドラゴン**:
- 最初のドラゴンを確保（種類によっては優先度低）
- 重要度: インフェルナル > マウンテン > クラウド > オーシャン

### 中盤（31-70ターン）

**重点**: ドラゴンスタック、ヘラルド
- 2-3体目のドラゴンを確保
- ヘラルドでタワー破壊を加速
- バフを活用したガンク・ローム

**ドラゴンスタック**:
- 同じ種類のドラゴンを3体確保してソウル獲得を狙う
- 敵チームのドラゴン数を確認し、阻止することも重要

### 終盤（71-120ターン）

**重点**: バロン、エルダードラゴン
- バロンバフでネクサスプッシュ
- エルダードラゴン確保で圧倒的有利
- バフを活用したチーム戦

**バロン戦略**:
- チーム全員でバロンを狙う
- バロンバフの18ターンを有効活用してプッシュ

---

## バフ効果まとめ

| バフ種類 | 主な効果 | 持続時間 | 獲得方法 |
|---------|---------|---------|---------|
| **赤バフ** | 攻撃力+2.0、スロー | 9ターン | ジャングルファーム |
| **青バフ** | ユーティリティ+2.0、CDR-1 | 9ターン | ジャングルファーム |
| **インフェルナル** | 攻撃力+1.5 | 永続 | ドラゴン撃破 |
| **マウンテン** | 防御力+1.5 | 永続 | ドラゴン撃破 |
| **オーシャン** | HP回復+50/ターン | 永続 | ドラゴン撃破 |
| **クラウド** | 移動力+1.0 | 永続 | ドラゴン撃破 |
| **バロン** | 攻撃力+3.0、防御+2.0、移動力+1.0、タワーダメージ+50% | 18ターン | バロン撃破 |
| **ヘラルド** | タワーに1500ダメージ | 1回のみ | ヘラルド撃破 |
| **エルダー** | 攻撃力+3.0、防御+2.0、追加30ダメージ | 永続 | エルダードラゴン撃破 |

---

## バフ/デバフの技術的管理

### バフ/デバフ配列管理

各プレイヤーは、バフ/デバフを配列で管理します。各要素は以下の構造を持ちます：

```javascript
{
  type: string,       // バフ/デバフの種類（例: "red_buff", "skill_damage_buff", "cc_debuff"）
  duration: number,   // 残りターン数（例: 3）
  value: number       // 効果値（例: +2.0攻撃力、-3ペナルティ）
}
```

#### 例: バフ/デバフ配列

```javascript
player.buffs = [
  { type: "red_buff", duration: 5, value: 2.0 },           // 赤バフ: 攻撃力+2.0、残り5ターン
  { type: "skill_damage_buff", duration: 2, value: 3.0 },  // スキルバフ: 攻撃力+3.0、残り2ターン
  { type: "dragon_infernal", duration: -1, value: 1.5 }    // インフェルナルドラゴン: 攻撃力+1.5、永続（-1）
];

player.debuffs = [
  { type: "cc_debuff", duration: 1, value: -3.0 },         // CCデバフ: -3ペナルティ、残り1ターン
  { type: "slow_debuff", duration: 1, value: -2.0 }        // スローデバフ: 移動力-2、残り1ターン
];
```

### ターン開始時のクリーンアップ処理

各ターン開始時に、以下の処理を実行します：

#### クリーンアップ手順

1. **バフ/デバフの持続時間減少**
   ```javascript
   for (let buff of player.buffs) {
     if (buff.duration > 0) {
       buff.duration -= 1;
     }
   }
   ```

2. **期限切れバフ/デバフの削除**
   ```javascript
   player.buffs = player.buffs.filter(buff => buff.duration !== 0);
   player.debuffs = player.debuffs.filter(debuff => debuff.duration !== 0);
   ```

3. **永続バフの保持**
   - `duration === -1`のバフは永続として保持される
   - 例: ドラゴンバフ、エルダードラゴンバフ

#### クリーンアップ処理の例

**ターン開始前**:
```javascript
player.buffs = [
  { type: "red_buff", duration: 1, value: 2.0 },
  { type: "skill_damage_buff", duration: 2, value: 3.0 }
];
```

**ターン開始時のクリーンアップ後**:
```javascript
// 持続時間を減少
player.buffs = [
  { type: "red_buff", duration: 0, value: 2.0 },           // 期限切れ
  { type: "skill_damage_buff", duration: 1, value: 3.0 }
];

// 期限切れを削除
player.buffs = [
  { type: "skill_damage_buff", duration: 1, value: 3.0 }
];
```

---

## スキルクールダウン管理

### スキルクールダウン構造

各スキルは以下の構造で管理します：

```javascript
{
  lastUsedTurn: number,        // 最後に使用したターン番号（例: 10）
  duration: number,            // クールダウン時間（例: 2ターン）
  cooldownRemaining: number    // 残りクールダウンターン数（例: 1）
}
```

#### 例: スキル管理

```javascript
player.skills = {
  normalSkill: {
    lastUsedTurn: 10,          // ターン10で使用
    duration: 2,               // 2ターンのクールダウン
    cooldownRemaining: 0       // 現在使用可能
  },
  ultSkill: {
    lastUsedTurn: 8,           // ターン8で使用
    duration: 5,               // 5ターンのクールダウン
    cooldownRemaining: 1       // あと1ターンで使用可能
  }
};
```

### クールダウン更新処理

#### ターン開始時の処理

1. **クールダウン減少**
   ```javascript
   for (let skill of Object.values(player.skills)) {
     if (skill.cooldownRemaining > 0) {
       skill.cooldownRemaining -= 1;
     }
   }
   ```

2. **使用可能判定**
   ```javascript
   function canUseSkill(skill) {
     return skill.cooldownRemaining === 0;
   }
   ```

#### スキル使用時の処理

```javascript
function useSkill(player, skillName, currentTurn) {
  let skill = player.skills[skillName];

  if (canUseSkill(skill)) {
    // スキル効果を適用
    applySkillEffect(player, skillName);

    // クールダウンをリセット
    skill.lastUsedTurn = currentTurn;
    skill.cooldownRemaining = skill.duration;

    // 青バフ効果: クールダウン-1
    if (hasBlueBuffEffect(player)) {
      skill.cooldownRemaining = Math.max(1, skill.cooldownRemaining - 1);
    }
  } else {
    throw new Error("スキルはクールダウン中です");
  }
}
```

---

## ステータス計算システム

### ステータス計算の順序

ステータスは以下の順序で計算されます：

1. **基礎ステータス**: キャラクターの基本ステータス（レベルによる成長含む）
2. **アイテムの基礎効果**: アイテムによる基礎ステータス上昇
3. **パッシブ効果**: アイテムのパッシブ効果
4. **バフ効果**: 一時的なバフによる上昇
5. **デバフ効果**: 一時的なデバフによる減少

### calculateFinalStats関数

```javascript
function calculateFinalStats(player) {
  let stats = {
    hp: 0,
    attack: 0,
    defense: 0,
    mobility: 0,
    utility: 0
  };

  // 1. 基礎ステータス
  stats.hp = player.baseStats.hp + (player.level * player.growthRates.hp);
  stats.attack = player.baseStats.attack + (player.level * player.growthRates.attack);
  stats.defense = player.baseStats.defense + (player.level * player.growthRates.defense);
  stats.mobility = player.baseStats.mobility + (player.level * player.growthRates.mobility);
  stats.utility = player.baseStats.utility + (player.level * player.growthRates.utility);

  // 2. アイテムの基礎効果
  for (let item of player.items) {
    stats.attack += item.baseAttack || 0;
    stats.defense += item.baseDefense || 0;
    stats.mobility += item.baseMobility || 0;
    stats.utility += item.baseUtility || 0;
  }

  // 3. パッシブ効果
  for (let item of player.items) {
    if (item.passive) {
      applyPassiveEffect(stats, item.passive);
    }
  }

  // 4. バフ効果
  for (let buff of player.buffs) {
    if (buff.type.includes("attack")) {
      stats.attack += buff.value;
    } else if (buff.type.includes("defense")) {
      stats.defense += buff.value;
    } else if (buff.type.includes("mobility")) {
      stats.mobility += buff.value;
    } else if (buff.type.includes("utility")) {
      stats.utility += buff.value;
    }
  }

  // 5. デバフ効果
  for (let debuff of player.debuffs) {
    if (debuff.type.includes("attack")) {
      stats.attack += debuff.value; // debuff.valueは負の値
    } else if (debuff.type.includes("defense")) {
      stats.defense += debuff.value;
    } else if (debuff.type.includes("mobility")) {
      stats.mobility += debuff.value;
    } else if (debuff.type.includes("utility")) {
      stats.utility += debuff.value;
    }
  }

  return stats;
}
```

### 使用例

```javascript
let player = {
  level: 6,
  baseStats: { hp: 600, attack: 5.0, defense: 4.0, mobility: 5, utility: 4 },
  growthRates: { hp: 50, attack: 0.5, defense: 0.3, mobility: 0, utility: 0.2 },
  items: [
    { name: "Long Sword", baseAttack: 1.5 },
    { name: "Cloth Armor", baseDefense: 1.0 }
  ],
  buffs: [
    { type: "red_buff", duration: 5, value: 2.0 },
    { type: "skill_damage_buff", duration: 2, value: 3.0 }
  ],
  debuffs: []
};

let finalStats = calculateFinalStats(player);
console.log(finalStats);
// {
//   hp: 900,
//   attack: 5.0 + 3.0 + 1.5 + 2.0 + 3.0 = 14.5,
//   defense: 4.0 + 1.8 + 1.0 = 6.8,
//   mobility: 5,
//   utility: 4 + 1.2 = 5.2
// }
```

---

## 変更履歴
- 2025-11-11: 技術的管理セクションを追加
  - バフ/デバフ配列管理システムを実装
  - ターン開始時のクリーンアップ処理を定義
  - スキルクールダウン管理システムを実装
  - calculateFinalStats関数によるステータス計算順序を定義
- 2025-11-09: 初版作成
  - ジャングルバフ（赤バフ、青バフ）の詳細効果を定義
  - オブジェクトバフ（ドラゴン、バロン、ヘラルド）の詳細効果を定義
  - バフの管理と戦略的使用方法を記載
