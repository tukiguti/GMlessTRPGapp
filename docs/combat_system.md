# GMレスLoL風TRPG - 戦闘・判定システム

## 目次
1. [視界システム](#視界システム)
2. [基本戦闘](#基本戦闘)
3. [マッチアップ判定](#マッチアップ判定)
4. [ダメージ計算](#ダメージ計算)
5. [デスとペナルティ](#デスとペナルティ)
6. [複数人戦闘](#複数人戦闘)

---

## 視界システム

### ワード（視界提供アイテム）

#### ワード配置
- **配置可能エリア**:
  - **レーン**: TOPレーン、MIDレーン、BOTレーン（各チーム側）
  - **ジャングル**:
    - 味方TOP-MIDジャングル
    - 味方MID-BOTジャングル
    - 敵TOP-MIDジャングル
    - 敵MID-BOTジャングル
  - **中立エリア**: ドラゴンピット、バロンピット付近

- **配置数制限**:
  - **SUP**: 3個まで配置可能
  - **その他のロール**: 1個まで配置可能

#### ワード破壊
- **発動条件**: プレイヤーがワードのあるエリアに進入
- **判定方法**: ダイス判定
  - 破壊判定ダイス: 1d20
  - 成功値: 12以上で破壊成功
- **視認**: ワードが存在することは進入時に自動で判明

### 視界の効果

#### 視界がある場合
- そのエリアに敵が進入したことを即座に把握
- ガンクを事前に察知可能
- マッチアップ判定にボーナスなし（通常判定）

#### 視界がない場合
- 敵の進入を把握不可
- ガンクされた際にペナルティ
- **JGとSUPのガンク時に+判定**（攻撃側有利）

---

## 基本戦闘

### マッチアップ判定

戦闘の基本となる判定システム。

#### 判定手順
1. **ダイスロール**: 両者が1d20をロール
2. **ステータス補正**: 攻撃力の補正値を加算
3. **視界補正**: 視界状況に応じた補正
4. **合計値比較**: 高い方が勝利

#### 判定式
```
マッチアップ判定値 = 1d20 + 攻撃力補正 + 状況補正
```

#### 判定例

**例**: レベル6のAPメイジ vs レベル6のADファイター

**プレイヤーA（APメイジ、攻撃力+7.5）**:
- ダイスロール: 15
- 判定値: 15 + 7.5 = 22.5

**プレイヤーB（ADファイター、攻撃力+4.5）**:
- ダイスロール: 12
- 判定値: 12 + 4.5 = 16.5

**結果**:
- 差分: 22.5 - 16.5 = 6
- プレイヤーA（メイジ）の勝利

---

## ダメージ計算

### ダメージ計算式

マッチアップ判定の結果に基づいてダメージを計算します。

**計算式**:
```
ダメージ = (勝者の判定値 - 敗者の判定値) × 10 - 敗者の防御力
```

- **引き分け**: 両者にダメージなし
- **最小ダメージ**: 0（防御力でダメージを完全に無効化可能）

### ダメージ計算例

**例**: 上記のマッチアップ判定の続き

**前提**:
- 差分: 6
- プレイヤーB（ファイター）の防御力: 6.4
- プレイヤーB（ファイター）のHP: 780

**ダメージ計算**:
```
ダメージ = 6 × 10 - 6.4 = 60 - 6.4 = 53.6ダメージ
```

**結果**:
- プレイヤーBのHP: 780 → 726.4

---

## デスとペナルティ

### デス条件
- HPが0以下になると撃破される

### デスペナルティ

#### 1. リスポーン時間
```
リスポーン時間 = 1ターン + (現在レベル × 0.2ターン)
```

**例**:
- レベル1: 1.2ターン（2ターン切り上げ）
- レベル10: 3ターン
- レベル18: 4.6ターン（5ターン切り上げ）

**注**: リスポーンターン数は切り上げ（最低2ターン）

#### 2. ゴールド喪失
- 現在所持ゴールドの10%を失う

#### 3. 経験値ターン提供
- **キラー（撃破者）**: +0.5経験値ターン獲得
- **アシスト（支援者）**: +0.5経験値ターン獲得

#### 4. リスポーン位置
- 自陣ネクサスから再スタート

### 復活後の状態
- **HP**: 全回復
- **位置**: 自陣ネクサスからスタート
- **アイテム**: そのまま保持
- **クールダウン**: リセットされない

---

## 複数人戦闘

複数人が戦闘に参加する場合のルールを定義します。

### 目次（複数人戦闘）
1. [基本ルール](#基本ルール複数人戦闘)
2. [ターゲット選択ルール](#ターゲット選択ルール)
3. [ポジショニングシステム](#ポジショニングシステム)
4. [数的有利とボーナス](#数的有利とボーナス)
5. [戦闘解決の流れ](#戦闘解決の流れ)
6. [AOEスキルの処理](#aoeスキルの処理)
7. [複数人戦闘の例](#複数人戦闘の例)

---

### 基本ルール（複数人戦闘）

#### 戦闘参加条件
- 同じエリアにいるプレイヤーは戦闘に参加可能
- 視界がある場合のみ、敵の存在を認識できる

#### 戦闘処理の原則
- **1ターンにつき1回の攻撃**: 各プレイヤーは1ターンに1回だけ攻撃可能
- **同時解決**: すべてのマッチアップ判定を同時に行う
- **ダメージ累積**: 複数人から攻撃を受けた場合、ダメージは累積する

---

### ターゲット選択ルール

#### ターゲット宣言タイミング
- **行動宣言フェーズ**: 各プレイヤーが攻撃対象を秘密裏に宣言
- **同時公開**: すべてのプレイヤーが宣言を同時に公開
- **解決**: 各マッチアップごとに判定を行う

#### ターゲット選択の制約

##### 基本制約
- **視界内のみ**: 視界がある敵のみターゲット可能
- **同一エリア**: 同じエリアにいる敵のみターゲット可能

##### ポジション制約（後述のポジショニングシステムを参照）
- **フロントライン優先**: バックラインの敵を攻撃するには条件がある
- **例外**: アサシン、高移動力キャラクターは制約が緩和される

#### ターゲット変更
- **毎ターン変更可能**: 次のターンで異なる敵をターゲット可能
- **制約は継続**: ポジション制約は常に適用される

#### 強制ターゲット（特殊効果）
- **タウントスキル**: 特定のスキルにより、攻撃対象を強制的に変更される（現在は未実装）
- **近接優先**: フロントライン同士は優先的に戦闘する

---

### ポジショニングシステム

複数人戦闘では、キャラクターの配置が重要です。

#### ポジションの種類

##### フロントライン（前線）
**配置されるロール**:
- **タンク**: ADタンク、APタンク、タンクサポート
- **ファイター**: ADファイター、APファイター

**役割**:
- 敵のフロントラインと戦闘
- バックラインを守る
- 敵の攻撃を受け止める

##### バックライン（後衛）
**配置されるロール**:
- **マークスマン**: ADマークスマン
- **メイジ**: APメイジ
- **サポート**: APサポート

**役割**:
- 後方から高火力で攻撃
- フロントラインを支援
- 敵のフロントラインを攻撃

##### フレキシブル（移動可能）
**配置されるロール**:
- **アサシン**: ADアサシン、APアサシン

**役割**:
- フロントラインとバックラインを自由に移動
- 敵のバックラインを直接攻撃
- 高リスク・高リターンの戦術

#### ポジション配置のタイミング
- **配置フェーズ**: 戦闘開始前にポジションを宣言
- **変更不可**: 戦闘中はポジション変更不可（アサシンの特殊行動を除く）

#### ポジション制約によるターゲット制限

##### 基本ルール
1. **フロントライン同士**: 制約なし、互いに自由に攻撃可能
2. **フロントライン → バックライン**: 敵のフロントラインが生存している場合、バックラインを攻撃不可
3. **バックライン → フロントライン**: 制約なし、自由に攻撃可能
4. **バックライン → バックライン**: 敵のフロントラインが全滅している場合のみ攻撃可能

##### アサシンの特殊ルール
- **バックライン突入**: 移動力判定（1d20 + 移動力 ≧ 14）に成功すれば、敵のバックラインを直接攻撃可能
- **失敗時**: 敵のフロントラインから機会攻撃（敵フロントラインの誰か1人が、アサシンに対して自動的にマッチアップ判定を行う。アサシンは-3ペナルティ）
- **成功時**: そのターン中、敵バックラインの任意の1人を攻撃可能

##### 高移動力キャラクターの特殊ルール
- **移動力10以上**: 移動力が10以上のキャラクターは、アサシンと同様にバックライン突入可能
- **判定**: 1d20 + 移動力 ≧ 14で成功

---

### 数的有利とボーナス

複数人が1人を攻撃する場合、数的有利のボーナスを得ます。

#### 数的有利ボーナス

| 人数比 | ボーナス | 例 |
|-------|---------|-----|
| **2v1** | +2 | 2人が1人を攻撃 |
| **3v1** | +3 | 3人が1人を攻撃 |
| **4v1** | +4 | 4人が1人を攻撃 |
| **5v1** | +5 | 5人が1人を攻撃 |
| **3v2** | +1（3人側） | 3人が2人を攻撃（3人側が数的有利） |
| **4v2** | +2（4人側） | 4人が2人を攻撃 |
| **4v3** | +1（4人側） | 4人が3人を攻撃 |
| **5v2** | +3（5人側） | 5人が2人を攻撃 |

#### ボーナス計算式
```
数的有利ボーナス = ⌊(攻撃側人数 - 防御側人数) / 防御側人数⌋
最大ボーナス = +5
```

**注**: ⌊ ⌋は切り捨て

#### フォーカスターゲット
- **複数人が同じ敵を攻撃**: 各攻撃者が独立してマッチアップ判定を行う
- **ダメージ累積**: 防御側は複数回のダメージを受ける
- **戦略的重要性**: 敵を素早く撃破するため、フォーカスターゲットが有効

---

### 戦闘解決の流れ

#### ステップ1: 配置フェーズ
1. 各チームがポジション配置を宣言
   - フロントライン
   - バックライン
   - アサシン（フレキシブル）

#### ステップ2: ターゲット宣言フェーズ
1. 各プレイヤーが攻撃対象を秘密裏に宣言
2. アサシン/高移動力キャラクターはバックライン突入を宣言
3. すべての宣言を同時に公開

#### ステップ3: 特殊判定フェーズ
1. **アサシン突入判定**: 1d20 + 移動力 ≧ 14
   - 成功: バックライン攻撃可能
   - 失敗: 敵フロントラインから機会攻撃（-3ペナルティ）

#### ステップ4: スキル使用フェーズ
1. 各プレイヤーがスキル使用を宣言
2. CC判定、バフ/デバフの適用
3. AOEスキルのターゲット決定

#### ステップ5: マッチアップ判定フェーズ
1. 各ペアごとにマッチアップ判定
2. 補正値の適用
   - 数的有利ボーナス
   - スキル効果
   - バフ/デバフ
   - ポジションペナルティ（アサシン失敗時など）

#### ステップ6: ダメージ計算フェーズ
1. 各マッチアップの結果からダメージ計算
2. ダメージ適用（累積）
3. HP確認、デス判定

---

### AOEスキルの処理

範囲攻撃スキル（Area of Effect）の処理ルール。

#### AOEスキルの種類

現在のスキルシステムでAOE効果を持つもの：
- **バフULT**: 最大3人の味方を強化
- **デバフULT**: 最大3人の敵を弱体化
- **範囲バフ通常スキル**: 最大3人の味方を強化
- **範囲バフULT**: 味方全員（5人）を強化

#### AOEスキルのターゲット選択

##### バフ系AOEスキル
- **対象**: 味方複数（最大3人または全員）
- **効果**: マッチアップ判定に+補正
- **持続**: 複数ターン

##### デバフ系AOEスキル
- **対象**: 敵複数（最大3人）
- **効果**: マッチアップ判定に-補正
- **持続**: 複数ターン

#### AOE範囲の判定
- **範囲制限**: 最大3人の場合、使用者が任意に選択
- **全員対象**: 味方全員の場合、同じエリアにいる味方全員に効果
- **視界不要**: 味方へのバフは視界不要
- **視界必要**: 敵へのデバフは視界が必要

---

### 複数人戦闘の例

#### 例1: 2v1戦闘（シンプルなフォーカス）

**シナリオ**: プレイヤーA、B（攻撃側）vs プレイヤーC（防御側）

**配置**:
- プレイヤーA（ADファイター）: フロントライン
- プレイヤーB（APメイジ）: バックライン
- プレイヤーC（ADタンク）: フロントライン

**ターゲット宣言**:
- プレイヤーA: プレイヤーCを攻撃
- プレイヤーB: プレイヤーCを攻撃（フロントライン→フロントラインなので可能）
- プレイヤーC: プレイヤーAを攻撃

**マッチアップ判定**:

**A vs C**:
- プレイヤーA: 1d20 + 6.0（攻撃力） + 2（数的有利2v1） = 1d20 + 8.0
- プレイヤーC: 1d20 + 3.0（攻撃力） = 1d20 + 3.0

**B vs C**:
- プレイヤーB: 1d20 + 7.5（攻撃力） + 2（数的有利2v1） = 1d20 + 9.5
- プレイヤーC: 1d20 + 3.0（攻撃力） = 1d20 + 3.0

**ダメージ計算**:
- 各マッチアップの結果に基づいてダメージ計算
- プレイヤーCは2回のダメージを受ける

---

#### 例2: 3v3戦闘（ポジション制約あり）

**シナリオ**: チームA（3人）vs チームB（3人）

**チームA**:
- プレイヤーA1（ADタンク）: フロントライン
- プレイヤーA2（APメイジ）: バックライン
- プレイヤーA3（ADマークスマン）: バックライン

**チームB**:
- プレイヤーB1（APファイター）: フロントライン
- プレイヤーB2（APメイジ）: バックライン
- プレイヤーB3（APサポート）: バックライン

**ターゲット宣言**:
- A1: B1を攻撃（フロントライン→フロントライン、OK）
- A2: B1を攻撃（バックライン→フロントライン、OK）
- A3: B1を攻撃（バックライン→フロントライン、OK）
- B1: A1を攻撃（フロントライン→フロントライン、OK）
- B2: A1を攻撃（バックライン→フロントライン、OK）
- B3: A1を攻撃（バックライン→フロントライン、OK）

**結果**: 両チームのフロントライン（A1 vs B1）に集中攻撃

**マッチアップ判定**:

**A1 vs B1**:
- A1: 1d20 + 3.0 + 2（数的有利3v1） = 1d20 + 5.0

**A2 vs B1**:
- A2: 1d20 + 7.5 + 2（数的有利3v1） = 1d20 + 9.5

**A3 vs B1**:
- A3: 1d20 + 7.0 + 2（数的有利3v1） = 1d20 + 9.0

**B1 vs A1**:
- B1: 1d20 + 6.0 + 2（数的有利3v1） = 1d20 + 8.0

**B2 vs A1**:
- B2: 1d20 + 7.5 + 2（数的有利3v1） = 1d20 + 9.5

**B3 vs A1**:
- B3: 1d20 + 2.0 + 2（数的有利3v1） = 1d20 + 4.0

**結果**: 両フロントラインが大ダメージを受ける

---

#### 例3: アサシンのバックライン突入（5v5）

**シナリオ**: チームA vs チームB、アサシンがバックラインに突入を試みる

**チームA**:
- A1（ADタンク）: フロントライン
- A2（APファイター）: フロントライン
- A3（ADアサシン）: アサシン（突入試行）
- A4（APメイジ）: バックライン
- A5（ADマークスマン）: バックライン

**チームB**:
- B1（ADタンク）: フロントライン
- B2（APファイター）: フロントライン
- B3（APメイジ）: バックライン
- B4（ADマークスマン）: バックライン
- B5（APサポート）: バックライン

**ターゲット宣言**:
- A3（アサシン）: B4（敵マークスマン）を攻撃宣言、バックライン突入を試みる

**アサシン突入判定**:
- A3の移動力: 8.0
- 判定: 1d20 + 8.0 ≧ 14
- ダイス: 10 → 18 ≧ 14 **成功！**

**マッチアップ判定**:
- A3 vs B4: 通常のマッチアップ判定
- A3（アサシン）: 1d20 + 9.0（攻撃力） = 1d20 + 9.0
- B4（マークスマン）: 1d20 + 7.0（攻撃力） = 1d20 + 7.0

**結果**: アサシンがバックラインのマークスマンに大ダメージ

**失敗した場合の例**:
- ダイス: 3 → 11 < 14 **失敗！**
- 敵フロントライン（B1またはB2）から機会攻撃
- B1 vs A3: A3は-3ペナルティ
- A3（アサシン）: 1d20 + 9.0 - 3（失敗ペナルティ） = 1d20 + 6.0

---

#### 例4: AOEスキルを使用した5v5戦闘

**シナリオ**: チームA vs チームB、サポートが範囲バフULTを使用

**チームA**:
- A1（ADタンク）: フロントライン
- A2（APファイター）: フロントライン
- A3（APメイジ）: バックライン
- A4（ADマークスマン）: バックライン
- A5（APサポート）: バックライン

**チームB**: 同様の構成

**スキル使用**:
- A5（サポート）が範囲バフULT（味方全員に+3、3ターン持続）を使用

**マッチアップ判定**:
- チームAの全員が+3ボーナスを受ける
- A1: 1d20 + 3.0（攻撃力） + 3（範囲バフ） = 1d20 + 6.0
- A2: 1d20 + 6.0 + 3 = 1d20 + 9.0
- A3: 1d20 + 7.5 + 3 = 1d20 + 10.5
- A4: 1d20 + 7.0 + 3 = 1d20 + 10.0
- A5: 1d20 + 2.0 + 3 = 1d20 + 5.0

**結果**: チームAが大幅に有利になり、3ターン持続

---

## 戦闘時の補正まとめ

| 状況 | 補正 | 条件 |
|------|------|------|
| **視界なし（ガンク）** | +3 | JG/SUPがガンクし、敵が視界を持たない |
| **移動力ボーナス** | +(移動力-6) | 移動力が6以上の場合 |
| **CC成功（通常スキル）** | 相手に-3 | CC判定成功＆回避失敗 |
| **CC成功（ULT）** | 相手に-6 | CC判定成功＆回避失敗 |
| **CC回避成功** | ペナルティ無効 | 回避判定成功 |
| **数的有利（2v1）** | +2 | 2人が1人を攻撃 |
| **数的有利（3v1）** | +3 | 3人が1人を攻撃 |
| **数的有利（4v1）** | +4 | 4人が1人を攻撃 |
| **数的有利（5v1）** | +5 | 5人が1人を攻撃 |
| **数的有利（不均衡）** | +1～3 | 3v2、4v2、4v3など |
| **アサシン突入失敗** | -3 | バックライン突入判定失敗時、機会攻撃を受ける |
| **ダメージスキル（通常）** | +3 | 自分のマッチアップ判定 |
| **ダメージスキル（ULT）** | +6 | 自分のマッチアップ判定 |
| **バフスキル（通常）** | +2 | 味方のマッチアップ判定、2ターン持続 |
| **バフスキル（ULT）** | +4 | 味方のマッチアップ判定、3ターン持続 |
| **デバフスキル（通常）** | -2 | 敵のマッチアップ判定、2ターン持続 |
| **デバフスキル（ULT）** | -4 | 敵のマッチアップ判定、3ターン持続 |
| **範囲バフ（通常）** | +1 | 最大3人の味方、2ターン持続 |
| **範囲バフ（ULT）** | +3 | 味方全員（5人）、3ターン持続 |

---

## 変更履歴
- 2025-11-10: 複数人戦闘システムの詳細化
  - ターゲット選択ルールの追加
  - ポジショニングシステムの導入（フロントライン、バックライン、アサシン）
  - アサシンのバックライン突入ルールの追加
  - 数的有利ボーナスの詳細化（2v1～5v1、不均衡な戦闘）
  - 戦闘解決の流れを6ステップに体系化
  - AOEスキルの処理ルールの追加
  - 複数人戦闘の例を4つ追加（2v1、3v3、アサシン突入、AOEスキル）
  - 戦闘時の補正まとめを拡充
- 2025-11-09: ゲームシステム大規模調整
  - CC効果を-5から-3（通常スキル）/-6（ULT）に変更
  - 移動力ボーナス閾値を5→6に変更
  - リスポーン時間を秒数からターン数に変更（1ターン + レベル×0.2ターン）
  - 経験値提供をXPから経験値ターン（+0.5ターン）に変更
- 2025-11-07: 初版作成（game_rules.mdから分割）
  - 視界システム、基本戦闘、マッチアップ判定、ダメージ計算、デスペナルティ、複数人戦闘を統合
